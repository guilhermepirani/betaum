{% extends "layout.html" %}

{% block title %}
    {{ bet[0].title }}
{% endblock %}

{% block style %}
    <link href="/static/css/bet-page.css" rel="stylesheet">
{% endblock%}

{% block main %}
    <div>
        <img class="img-fluid" src="{{ bet[0].image }}" width="1100" height="500">
    </div>
    <div class="title">
        <h3>{{ bet[0].title }}</h3>
    </div>
    <h5>{{ bet[0].format }}</h5>
    <div class="header">
        <label>Date: </label><p>{{ bet[0].date }}</p>
        <label>Entry: </label><p>{{ bet[0].requirements }}</p>
    </div>
    <div class="bet-info">
        <div class="address">
            {% if not 'Online' in bet[0].address %}
                <label>Address: </label><p>{{ bet[0].address }}</p>
            {% else %}
                <label>Running Online</label>
            {% endif %}
        </div>
        <label>Invited</label>
        <div class="avatar">
            {% for row in people %}
                {% if row.invited == bet[0].id %}
                    <a><img src="./static/img/user.svg" alt="Users' Avatars"></a>
                {% endif %}
            {% endfor %}
        </div>
        <label>Joined</label>
        <div class="avatar">
            {% for row in people %}
                {% if row.joined == bet[0].id %}
                    <a><img src="./static/img/user.svg" alt="Users' Avatars"></a>
                {% endif %}
            {% endfor %}
        </div>
        <div class="about">
            {% if bet[0].about != None %}
                <label>About: </label>
                <p class="about">{{ bet[0].about }}</p>
            {% endif %}
        </div>
    </div>
    <div class="footer fixed-bottom d-flex">
        {% if bet[0].creator == user %}
            <button class="btn fixed-btn flex-fill" data-toggle="modal" data-target="#editModal">Edit</button>
                <div class="modal" id="editModal">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Edit Bet</h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <form action="/bet-page?bet_id={{ bet[0].id }}" method="POST" enctype="multipart/form-data">
                                    <label for="bname">Bet title:</label>
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="bname" value="{{ bet[0].title }}" name="bname" maxlength="30" required="">
                                    </div>
                                    <label for="entry">Required of each participant:</label>
                                    <div class="form-group">
                                        <input type="text" class="form-control" id="entry" value="{{ bet[0].requirements }}" name="entry" maxlength="30" required="">
                                    </div>
                                    <label for="date">Date:</label>
                                    <div class="form-group">
                                        <input type="date" class="form-control" id="date" value="{{ bet[0].date }}" name="date">
                                    </div>
                                    <div class="form-group">
                                        <label for="place">Address:</label>
                                        <input type="text" class="form-control" id="place" value="{{ bet[0].address }}" maxlength="60" name="place">
                                    </div>
                                    <label for="about">About: <span>Max 300 characters</span></label>
                                    <div class="input-block">
                                        <textarea class="form-control" id="about" name="about" maxlength="300">{{ bet[0].about }}</textarea>
                                    </div>
                                    <label>Add image (Optional):</label>
                                    <div class="custom-file">
                                        <input type="file" class="custom-file-input" id="customFile" name="file">
                                        <label class="custom-file-label" for="customFile"></label>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" onclick="confirmDelete()" class="btn btn-danger" data-dismiss="modal">Delete Bet</button>
                                        <button type="submit" value="Upload" class="btn btn-primary">Submit</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
        {% endif %}
        {% for row in people %}
            {% if row.user == user and row.joined == bet[0].id %}
                <button class="btn fixed-btn flex-fill" data-toggle="modal" data-target="#inviteModal">Invite</button>
                <div class="modal" id="inviteModal">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4 class="modal-title">Bet Invites</h4>
                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                Modal body..
                            </div>
                            <div class="modal-footer">
                                <button id="invite-btn" type="submit" class="btn btn-primary" data-dismiss="modal">Invite</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
            {% if row.user == user and row.invited == bet[0].id %}
                <button class="btn fixed-btn flex-fill">Join</button>
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}

{% block script %}
<script>
    function confirmDelete() {
      var r = confirm("Are you sure you want to delete this bet?\nThis is irreversible.\nPres OK to delete or Cancel to return to bet page");
      if (r == true) {
        window.location.replace("/delete-bet?bet_id={{ bet[0].id }}");
        }
    }
</script>
{% endblock %}